// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum TaxDocumentType {
  BOLETA
  FACTURA
  NOTA_CREDITO
  NOTA_DEBITO
}

enum TaxDocumentStatus {
  DRAFT
  ISSUED
  CANCELLED
  REJECTED
}

model TaxDocument {
  id               String            @id @default(cuid())
  type             TaxDocumentType
  folio            String?
  documentCode     Int?
  openFacturaId    String?           @unique
  emitterRUT       String?
  emitterName      String?
  receiverRUT      String?
  receiverName     String?
  netAmount        Decimal?          @db.Decimal(12, 2)
  taxAmount        Decimal?          @db.Decimal(12, 2)
  totalAmount      Decimal?          @db.Decimal(12, 2)
  currency         String?           @default("CLP")
  issuedAt         DateTime?
  status           TaxDocumentStatus @default(DRAFT)
  pdfUrl           String?
  xmlUrl           String?
  rawResponse      Json?
  notes            String?
  posTransactionId String?
  costId           String?
  tenantId         String?
  createdBy        String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  items TaxDocumentItem[]

  @@map("tax_documents")
}

model TaxDocumentItem {
  id            String  @id @default(cuid())
  taxDocumentId String
  productName   String
  quantity      Int
  unitPrice     Decimal @db.Decimal(12, 2)
  totalPrice    Decimal @db.Decimal(12, 2)
  sku           String?
  category      String?

  taxDocument TaxDocument @relation(fields: [taxDocumentId], references: [id], onDelete: Cascade)

  @@map("tax_document_items")
}